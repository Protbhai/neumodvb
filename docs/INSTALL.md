# neumoDVB #
## Installation ##

### Install prerequisite software ###

This software depends on several other software packages. If you wish to compile from source,
also a number of development packages are needed. The names of the packages depend on your linux
distribution.

On Fedora 33 or 34, install at least the following RPMs with "sudo dnf install -y &lt;PACKAGE&gt;":

* clang clang-tools-extra libtool #used for compiling and building
* boost-program-options boost-regex curl-devel
* log4cxx log4cxx-devel
* wxGTK3 gtk3-devel freeglut-devel librsvg2-devel libexif-devel libexif
* python3-wxpython4  python3-jinja2 python3-matplotlib-wx python3-sip-devel  python3-configobj
* python3-regex
* wxWidgets-devel mpv-libs-devel ffmpeg-devel ffmpeg-libs
* libdvbcsa-devel
* tsduck #used for t2mi streams; install as: sudo dnf install https://github.com/tsduck/tsduck/releases/download/v3.28-2551/tsduck-3.28-2551.fc34.x86_64.rpm

* espeak #used to read out load the SNR level

In addition, some python code needs to be installed using "sudo pip3 install &lt;PACKAGE&gt;";
at least the following packages are needed:

* regex setproctitle
* python3-matplotlib-wx mpl_scatter_density

The above software list may be incomplete or may contain no longer needed packages.
Please open a ticket if you discover mistakes

If you encounter errors like
```
fatal error: PCH file '.../cmake_pch.hxx.gch' is out of date and needs to be rebuilt: module file out of date
```
after installing missing files halfway during compilation, then this may be due to a bug in cmake:
cmake version 3.19 should work, but cmake 3.20 will not (probably a bug).
As a workaround, you can also just remove the precompiled headers. The easiest is:
```
cd ~/neumodvb/build
rm -fr *
cmake ..
make -j8
```

### Install blindscan drivers ###

neumoDVB can work with the regular linuxDVB drivers and supports all cards supported by these drivers.

If you own a supported card, it is best to install the neumo blindscan kerel drivers.
These drivers are available at
[https://github.com/deeptho/blindscan](https://github.com/deeptho/blindscan).

Without these drivers, features like blindscan and spectral analysis will not work.
neumoDVB has not been tested with the regular kernel drivers. Crashes may occur if you try
to use unsupported features. These are bugs. Report them on the issue tracker.



### Download and compile neumodvb ###

The software can be downloaded as follows

```
    cd ~/
    git clone --recursive https://github.com/deeptho/neumodvb
```

Next, build NeumoDVB as follows:

```
    cd ~/neumodvb
    mkdir build
    mkdir build_ext
    cd ~/neumodvb/build
    cmake ..
    make -j8
```
In case of problems, first check for missing pre-requisite software. For some of the pre-requisite
software, fairly recent versions are needed.

For troubleshooting, the following information may be useful:

* Some of the source code being compiled is generated by a python script `src/neumodb/neumodb.py`,
  which takes its input from configuration files `dbdefs.py` located in `src/neumodb/chdb`, and similar
  directories. The resulting code is placed in `build/src/neumodb/chdb` and similar places
* To speed up compilation, some C++ headers are pre-compiled. Usually this works fine, but in some
  cases, after making changes to header files, the precompiled headers become out of date and
  need to be rebuild, Usually  this will be clear from  compiler errors, but in rare cases, the
  result will be worse: neumoDVB will compile and then crash in strange ways.  When this happens,
  remove all  files under `/build`, run `cmake ..` again in the build directory.

  Alternatively, modify the CMakeList.txt files to remove header pre-compilation
* That being said, the normal and fastest way of recompiling after making changes to sources -- which should work
  in most cases -- is simply as follows:

````
    cd ~/neumodvb/build;
    make -j8
````

* In any case, if your distribution uses `ccache`, compilation will be much faster the second time around,
  even after you clear `build/` completely.
* NeumoDVB contains copies of some external software packages, some of which have been modified.
 * Specifically, the database code `lmdb` (renamed to `neumolmdb` to avoid confusion with any existing lmdb
  on your system) contains a few small, but crucial changes compared to the source (e.g., related to setting the
  `FD_CLOEXEC` flag.
 * The `wxsvg` library (renamed to `neumowxsvg`) has been more heavily modified. The modifications
  consist of added code to allow for efficient embedded of the mpv video player.


After NeumoDVB has been built successfully, you can install it if you wish. Installation is optional:
you also run the software directly from the build tree. This makes it easier to debug problems.

```
    cd ~/neumodvb/build
    sudo make install
```
For packaging purposes, commands like ' make install DESTDIR=/tmp/temporary_location` also work fine.
